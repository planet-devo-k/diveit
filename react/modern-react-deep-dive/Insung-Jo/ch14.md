# 14장. 웹사이트 보안을 위한 리액트와 웹페이지 보안 이슈

## 1. 리액트에서 발생하는 크로스 사이트 스크립팅 (XSS)

XSS(Cross-Site Scripting)는 공격자가 웹사이트에 악성 스크립트를 삽입해 실행하는 공격입니다.

### 1.1 리액트의 기본 방어와 취약점

**기본 방어**: 리액트는 기본적으로 데이터 바인딩 시 이스케이프(Escape) 처리를 수행하므로 XSS로부터 비교적 안전합니다.

**취약점 발생 케이스**:

1. `dangerouslySetInnerHTML` 사용:
   - `__html` 키를 통해 HTML을 직접 삽입할 때 발생합니다.
   - 예: `<div dangerouslySetInnerHTML={{ __html: rawHTML }} />`
2. `useRef`를 통한 직접 DOM 조작:
   - `ref.current.innerHTML` 등으로 직접 HTML을 삽입하면 리액트의 보호를 받지 못합니다.

### 1.2 대응 방안 (Sanitize)

- 제 3자가 입력한 HTML을 그대로 렌더링해야 한다면 반드시 **새니타이즈(Sanitize)** 과정을 거쳐야 합니다.

**라이브러리 추천**:

- **DOMPurify**: 가장 널리 사용되며, 악성 스크립트 태그를 제거하고 안전한 HTML만 남깁니다.

- **sanitize-html**, **js-xss** 등.
  **서버 측 처리 권장**: 클라이언트보다 서버에서 데이터를 저장할 때 이스케이프/새니타이즈 처리하는 것이 더 안전합니다.

## 2. 서버 사이드 렌더링 (SSR)과 보안

### 2.1 getServerSideProps 및 서버 컴포넌트 주의사항

**데이터 노출 위험**: `getServerSideProps`가 반환하는 `props` 객체는 HTML에 직렬화되어 포함되므로 전역 변수(`__NEXT_DATA__` 등)로 브라우저에 노출됩니다.

**주의할 점**:

- API Key, 세션 토큰, 비밀 설정 값 등 민감한 정보는 절대 `props`로 클라이언트에 넘기면 안 됩니다.
- 클라이언트에 필요한 최소한의 데이터만 가공하여 전달해야 합니다.

## 3. `<a>` 태그와 href 보안 이슈

**javascript: 프로토콜 차단**:

- `href="javascript:;"` 형태는 안티 패턴이며 XSS 위험이 있습니다. 이벤트 핸들링이 목적이라면 `<button>`을 사용해야 합니다.

**오픈 리다이렉트(Open Redirect) 방지**:

- 사용자가 입력한 주소로 이동하는 경우, 피싱 사이트로 연결될 수 있습니다.
- http, https 프로토콜인지 확인하거나, 허용된 도메인(Allow-list)인지 검증해야 합니다.

## 4. HTTP 보안 헤더 설정 (HTTP Security Headers)

`next.config.js`나 웹 서버(Nginx 등) 설정을 통해 보안 헤더를 추가하여 브라우저 레벨에서 취약점을 방어할 수 있습니다.

### 4.1 주요 보안 헤더

**Strict-Transport-Security (HSTS)**:

- 모든 통신을 HTTPS로 강제합니다.
  **X-XSS-Protection**:
- 비표준이지만 구형 브라우저를 위해 사용. XSS 공격 감지 시 페이지 로드를 중단합니다.

**X-Frame-Options**:

- `iframe` 등에서 페이지가 렌더링되는 것을 제어하여 **클릭재킹(Clickjacking)** 공격을 방지합니다.
- 옵션: `DENY` (불가), `SAMEORIGIN` (같은 도메인만 허용).

**Permissions-Policy**:

- 카메라, 마이크, 위치 정보 등 브라우저 기능 사용 권한을 명시적으로 제어합니다.

**X-Content-Type-Options**:

- `nosniff` 옵션을 사용하여 브라우저가 MIME 타입을 임의로 추측하여 실행하는 것을 방지합니다 (예: 이미지 파일을 스크립트로 실행하는 공격 방어).

**Referrer-Policy**:

- 다른 페이지로 이동 시 `Referer` 헤더에 담길 정보의 양을 제어합니다. (사용자 개인정보 보호).

**Content-Security-Policy (CSP)**:

- **가장 강력한 보안 수단**. 스크립트, 스타일, 이미지 등을 불러올 수 있는 출처(Origin)를 엄격히 제한합니다.
- 예: `script-src 'self' https://trusted.cdn.com` (자신과 신뢰된 CDN의 스크립트만 허용).

## 5. 취약점 관리

**의존성 패키지 관리**: `npm audit`이나 `Snyk` 같은 도구를 사용하여 사용 중인 라이브러리의 보안 취약점을 주기적으로 점검하고 업데이트해야 합니다.

**OWASP Top 10**: 웹 애플리케이션의 주요 10대 보안 취약점(인젝션, 인증 실패 등)을 숙지하고 대비해야 합니다.
