# 🔐 모던 웹 보안 아키텍처 심층 가이드: 리액트와 Next.js를 중심으로

웹 보안은 단순히 기능을 구현하는 것을 넘어, **"신뢰할 수 없는 모든 외부 데이터로부터 시스템을 보호하는 것"**에 목적이 있음. 프론트엔드 개발자가 반드시 숙지해야 할 핵심 보안 영역을 5가지 테마로 나누어 상세히 분석.

---

## 1. 크로스 사이트 스크립팅(XSS) 방어 전략

XSS는 공격자가 악성 스크립트를 삽입하여 사용자의 세션을 탈취하거나 정보를 조작하는 공격. 리액트는 기본적으로 '자동 이스케이프' 기능을 제공하지만, 개발자의 실수로 구멍이 생길 수 있음.

### 리액트 내 주요 취약점 경로

1. **`dangerouslySetInnerHTML`:** 이름 그대로 매우 위험한 속성. 브라우저 DOM의 `innerHTML`을 직접 교체하므로, 검증되지 않은 사용자의 입력값이 그대로 실행될 수 있음.
2. **`useRef` 직접 조작:** 리액트의 상태 관리 밖에서 `ref.current.innerHTML`을 통해 데이터를 주입하는 경우, 리액트의 보안 필터를 우회하게 되어 위험.
3. **`<a>` 태그의 `javascript:` 프로토콜:** `href="javascript:alert('XSS')"`와 같은 코드는 클릭 시 스크립트를 실행. 이는 매우 오래된 방식이지만 여전히 유효한 공격 통로.
4. **SVG 이미지 내 악성 코드:** `<svg onload="...">` 처럼 이미지 파일 내부에 스크립트를 심어 실행시키는 방식이 존재.
5. **쿼리 스트링 및 URL 파라미터:** `?search=<script>...`와 같이 URL에 포함된 데이터를 검증 없이 화면에 출력하거나 로직에 사용할 때 발생.

### 실무 대응 방안

* **Sanitize(세척) 라이브러리 도입:** HTML 구조를 유지해야 한다면 **`DOMPurify`**나 **`sanitize-html`** 같은 라이브러리를 사용하기. 허용된 태그만 남기는 **'Allow List'** 방식이 가장 안전.
* **서버 측 최종 필터링:** 클라이언트에서의 세척은 `curl` 등을 이용한 직접 API 호출 공격에 무력. 반드시 서버(백엔드)에서 최종적으로 이스케이프 처리를 해야 함.
* **컴포넌트 설계:** 페이지 이동이 목적이 아닌 인터랙션은 `<a>` 대신 반드시 `<button>`을 사용하고, 데이터 출력 시에는 리액트의 기본 중괄호`{ }` 문법을 사용하여 자동 이스케이프를 활용하기.

---

## 2. 서버 사이드 렌더링(SSR) 및 데이터 노출 관리

Next.js의 `getServerSideProps`나 리액트 서버 컴포넌트(RSC)를 사용할 때는 클라이언트로 전송되는 데이터 범위를 철저히 제한해야 .

### 정보 노출 위험 요소

1. **`props`의 전역 노출:** `getServerSideProps`가 반환하는 모든 데이터는 HTML의 `<script id="__NEXT_DATA__">` 태그 안에 JSON 형태로 기록됩니다. 소스 보기만으로 누구나 읽을 수 있음.
2. **민감한 쿠키 정보:** 서버에서만 사용해야 할 인증 정보나 쿠키 전체를 클라이언트로 넘기는 것은 세션 탈취의 지름길.
3. **`PRELOADED_STATE` 취약점:** Redux 등의 초기 상태를 주입할 때 사용하는 전역 변수는 XSS 공격자가 데이터를 조작하기 가장 좋은 먹잇감.

### 보안 강화 전략

* **최소 데이터 원칙:** 유저 객체 전체(`user`)를 넘기지 말고, 화면에 필요한 `name`, `email`만 선언적으로 추출해서 반환하기.
* **토큰 최소화:** 클라이언트에 필요한 최소한의 액세스 토큰만 전달하고, 민감한 처리는 서버에서 직접 수행한 뒤 결과만 전달하기.
* **Redirect 서버 처리:** 인증 실패 시 클라이언트에서 `window.location`을 바꾸기보다, 서버 사이드에서 리다이렉트 응답을 보내 보안 로직을 강제하기.

---

## 3. HTTP 보안 헤더: 브라우저 행동 지침서

보안 헤더는 서버가 브라우저에게 "이 사이트를 렌더링할 때 다음의 보안 규칙을 엄격히 준수하라"고 내리는 명령.

### 필수 보안 헤더 5가지

1. **Strict-Transport-Security (HSTS):** 모든 접속을 강제로 HTTPS로 전환하며, 특정 기간(`max-age`) 동안 브라우저가 이 설정을 기억하게 함.
2. **X-Frame-Options:** 내 페이지가 타 사이트의 `iframe` 내에서 렌더링되는 것을 막아 **클릭재킹(Clickjacking)** 공격을 방지. (`DENY` 추천)
3. **Permissions-Policy:** 카메라, 마이크, 위치 정보(GPS) 등 브라우저의 강력한 기능을 특정 페이지나 도메인에서만 사용하도록 제한.
4. **X-Content-Type-Options:** 브라우저가 파일의 내용을 멋대로 추측(MIME Sniffing)하여 이미지를 스크립트로 실행하는 등의 오작동을 막음. (`nosniff` 고정)
5. **Referrer-Policy:** 다른 사이트로 이동할 때 내 사이트의 상세 주소 정보를 어디까지 노출할지 결정. (`strict-origin-when-cross-origin` 추천)

---

## 4. Content-Security-Policy (CSP) 심층 활용

CSP는 가장 강력한 현대적 보안 수단으로, 웹사이트에서 실행될 수 있는 모든 리소스의 **출처(Origin)**를 화이트리스트로 관리.

### 주요 지시문과 설정법

* **`default-src 'self'`:** 모든 리소스의 기본 출처를 자기 자신으로 제한.
* **`script-src`:** 신뢰할 수 있는 외부 도메인(예: `analytics.google.com`)만 명시하여 인라인 스크립트 공격을 원천 차단.
* **`font-src` / `img-src`:** 외부 폰트나 이미지 서버를 지정하여 데이터 삽입 공격을 방지.
* **`form-action`:** 폼 데이터가 전송될 목적지 주소를 제한하여, 피싱 사이트로 데이터가 흘러나가는 것을 막음.

### 💡 실무 팁 (Next.js 설정)

`next.config.js`의 `headers` 설정을 통해 경로별로 차등화된 CSP를 적용할 수 있음. 예를 들어, 어드민 페이지(`/admin`)에는 일반 페이지보다 훨씬 강력한 지시문을 적용하는 식의 설계가 가능.

---

## 5. 의존성 보안 및 지속적 관리

모던 웹 개발은 수천 개의 오픈소스 패키지에 의존. 내가 짠 코드가 안전해도 라이브러리가 취약하면 전체 시스템이 무너짐.

### 패키지 보안 관리 프로세스

1. **Dependabot 활성화:** GitHub 저장소의 `package-lock.json`을 실시간 감시하고 취약점 발견 시 자동으로 보안 패치 PR을 생성하도록 설정하기.
2. **Snyk 활용:** 실시간 취약점 데이터베이스를 보유한 Snyk를 사용하여 개발 파이프라인에서 보안 검사를 자동화하기.
3. **npm overrides 활용:** 특정 라이브러리의 하위 의존성(간접 의존성)에 취약점이 있을 때, 이를 강제로 최신 버전으로 올리기 위해 `package.json`의 `overrides` 필드를 사용하기.
4. **OWASP Top 10 숙지:** 매년 업데이트되는 '10대 보안 취약점' 리스트를 주기적으로 확인하여 공격 트렌드의 변화(예: ReDoS, 데이터 무결성 실패 등)를 파악하기.
5. **에러 로그 관리:** 브라우저 콘솔이나 서버 로그에 민감한 정보(API 키, 개인정보)가 남지 않도록 개발 단계에서 철저히 관리하기.

---

**정리하며:** 보안은 결코 한 번의 설정으로 끝나지 않음. **"신뢰할 수 없는 데이터는 세척(Sanitize)하고, 노출은 최소화하며, 브라우저가 스스로를 지킬 수 있도록 명확한 지침(보안 헤더)을 내리는 것"**이 모던 리액트 개발의 정석.