# 🚀 웹페이지 성능 측정과 최적화: 도구 활용부터 실전 전략까지

웹 성능은 단순히 '빠르다'는 느낌을 넘어, 비즈니스 지표와 직결되는 핵심 요소. 이를 정밀하게 측정하고 개선하기 위한 다양한 방법론을 정리.

---

## 1. 애플리케이션 레벨의 실시간 모니터링

사용자가 실제로 겪는 성능을 데이터로 수집하는 방법.

* **`web-vitals` 라이브러리:** 브라우저의 `PerformanceObserver` API를 활용하여 핵심 웹 지표를 수집함. 수집된 데이터는 `sendBeacon` API(소량의 분석 데이터를 안정적으로 전송)나 `fetch`를 통해 서버 또는 구글 애널리틱스로 전송할 수 있음.
* **Next.js 전용 지표:** Next.js는 `NextWebVitalsMetric`을 통해 프레임워크 특화 지표를 제공함.
* `Next.js-hydration`: 서버 렌더링 후 하이드레이션에 소요된 시간.
* `Next.js-route-change-to-render`: 경로 변경 시점부터 렌더링 시작까지의 지연 시간.
* `Next.js-render`: 경로 변경 후 실제 렌더링 완료까지 걸린 시간.

---

## 2. 구글 라이트하우스 (Lighthouse): 종합 진단 도구

크롬 개발자 도구에 내장된 라이트하우스는 성능뿐만 아니라 웹의 전반적인 품질을 검사함.

### 2-1. 주요 측정 모드

* **탐색 모드(Navigation):** 페이지 접속부터 로드 완료까지의 성능을 분석함.
* **기간 모드(Timespan):** 사용자가 특정 동작(예: 장바구니 담기)을 수행하는 동안의 성능을 분석함. '트리맵'을 통해 미사용 자바스크립트 비중을 파악하기 좋음.
* **스냅샷(Snapshot):** 현재 페이지의 상태(DOM 구조, 접근성 등)를 분석함.

### 2-2. 성능 지표 상세

* **Total Blocking Time (TBT):** 메인 스레드가 50ms 이상 차단된 'Long Task' 시간의 합계. FCP와 TTI 사이의 구간을 측정하며, 자바스크립트 실행 최적화의 핵심 지표.
* **Speed Index:** 콘텐츠가 시각적으로 얼마나 빨리 채워지는지를 프레임별로 분석하여 수치화함.

### 2-3. 권장사항 및 접근성 (Best Practices)

* **보안:** CSP(콘텐츠 보안 정책) 수립 여부와 HTTPS 적용, 보안 취약점이 있는 라이브러리 사용 여부를 체크함.
* **사용자 경험:** 비밀번호 필드 붙여넣기 허용(비밀번호 관리자 사용 권장), 위치 정보/알림 권한 요청의 적절성 등을 확인함.
* **접근성:** 스크린 리더 사용자를 위한 `alt` 속성, 키보드 접근성, 자막 제공 등을 검토함.

---

## 3. 크롬 개발자 도구: Performance 패널 분석

가장 강력하고 정밀한 분석 도구. 측정 전 반드시 뷰포트를 확보하고 시크릿 모드에서 진행해야 정확함.

* **Insights 패널:** 최근 업데이트를 통해 성능 이슈를 자동으로 요약하여 보여줌.
* **CPU 그래프 분석:**
* **노란색(Scripting):** 자바스크립트 실행 중.
* **보라색(Rendering):** 레이아웃 계산 중.
* **초록색(Painting):** 픽셀을 화면에 그리는 중.
* **빨간색 선:** 50ms를 넘긴 **Long Task** 구간으로, 최우선 개선 대상.


* **Network 타임라인:**
* **하늘색(대기 시간, TTFB):** 서버 응답 속도 문제.
* **파란색(다운로드 시간):** 파일 용량 또는 네트워크 속도 문제.


* **User Timing API:** `performance.mark()`와 `measure()`를 사용하여 개발자가 정의한 특정 로직의 구간 속도를 직접 측정할 수 있음.

---

## 4. WebPageTest: 글로벌 성능 테스트

한국 이외의 지역에서 접속하는 환경을 시뮬레이션할 때 유용함.

* **Is it Quick/Usable/Resilient:** 단순히 속도만 재는 것이 아니라, 보안 취약성이나 렌더링 블로킹 요소가 있는지 종합 평가를 내림.
* **Keep-Alive & GZip:** 서버와의 연결 유지 및 리소스 압축이 제대로 설정되었는지 확인.
* **Request Map:** 리소스 간의 연쇄적인 요청 흐름(Waterfall)을 시각화하여, 어떤 파일이 전체 로드를 지연시키는지 파악.

---

## 5. 실전 리소스 최적화 전략

측정된 지표를 바탕으로 적용해야 할 구체적인 기법들.

### 5-1. 이미지 및 아이콘 관리

* **동적 리사이징:** Cloudinary나 Imgix 같은 Image CDN을 사용하여 사용자 기기 해상도에 맞는 이미지를 실시간으로 생성·제공함.
* **SVG Stack:** 여러 아이콘을 하나의 SVG 파일 내 `<symbol>`로 관리하고 `<use>` 태그로 호출하여 네트워크 요청 수를 1회로 줄임.
* **Progressive JPEG:** 위에서 아래로 그려지는 방식이 아닌, 전체가 흐릿했다가 선명해지는 방식으로 체감 로딩 속도를 높임.

### 5-2. 폰트 최적화

* **Self-hosting:** 브라우저 보안 정책 변경으로 인해 더 이상 제3자 호스트(Google Fonts 등)의 캐싱 이점이 없음. 폰트는 직접 서버에서 호스팅하는 것이 유리함.
* **WOFF2 & Subset:** .woff2 형식을 사용하고, 자주 쓰지 않는 글자를 제거한 '서브셋' 파일을 만들어 용량을 최소화함.
* **Preload & Font-display:** `<link rel="preload">`로 폰트를 우선 로드하고, `font-display: optional`을 사용하여 폰트 로딩 지연으로 인한 레이아웃 이동(CLS)을 방지함.

### 5-3. 코드 및 네트워크 최적화

* **코드 스플리팅:** 초기 로드에 불필요한 레이어, 팝업 등은 `React.lazy`나 Next.js의 `dynamic`으로 분리함.
* **Scripts 제어:** 타사 스크립트는 `defer`나 `async`를 활용하되, 가급적 파싱을 방해하지 않는 `defer`를 우선적으로 고려함.
* ** robots.txt:** 검색 엔진 크롤러가 보안 구역(admin 등)을 훑지 않도록 차단하여 효율적인 인덱싱을 유도함.

---

**정리하며:** 성능 최적화는 한 번의 작업으로 끝나는 것이 아니라, 개발 도구의 **지표 확인 → 원인 분석 → 최적화 기법 적용 → 재측정**의 반복 과정. 특히 `Long Task`를 줄여 메인 스레드를 확보하는 것이 현대 웹 성능의 핵심임을 잊지 말기.
